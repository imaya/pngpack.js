/** @license pngpack.js 2012 - imaya [ https://github.com/imaya/pngpack.js ] The MIT License */(function() {'use strict';function r(b){throw b;}var t=void 0,u=this;function v(b,c){var e=b.split("."),d=u;!(e[0]in d)&&d.execScript&&d.execScript("var "+e[0]);for(var f;e.length&&(f=e.shift());)!e.length&&c!==t?d[f]=c:d=d[f]?d[f]:d[f]={}};var w="undefined"!==typeof Uint8Array&&"undefined"!==typeof Uint16Array&&"undefined"!==typeof Uint32Array;function x(b){var c=b.length,e=0,d=Number.POSITIVE_INFINITY,f,g,l,k,h,m,q,n,p;for(n=0;n<c;++n)b[n]>e&&(e=b[n]),b[n]<d&&(d=b[n]);f=1<<e;g=new (w?Uint32Array:Array)(f);l=1;k=0;for(h=2;l<=e;){for(n=0;n<c;++n)if(b[n]===l){m=0;q=k;for(p=0;p<l;++p)m=m<<1|q&1,q>>=1;for(p=m;p<f;p+=h)g[p]=l<<16|n;++k}++l;k<<=1;h<<=1}return[g,e,d]};function y(b,c){this.i=[];this.j=32768;this.d=this.g=this.c=this.m=0;this.f=w?new Uint8Array(b):b;this.o=!1;this.k=z;this.r=!1;if(c||!(c={}))c.index&&(this.c=c.index),c.bufferSize&&(this.j=c.bufferSize),c.bufferType&&(this.k=c.bufferType),c.resize&&(this.r=c.resize);switch(this.k){case A:this.a=32768;this.b=new (w?Uint8Array:Array)(32768+this.j+258);break;case z:this.a=0;this.b=new (w?Uint8Array:Array)(this.j);this.e=this.v;this.p=this.t;this.l=this.u;break;default:r(Error("invalid inflate mode"))}}
var A=0,z=1,B=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],C=w?new Uint16Array(B):B,D=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],E=w?new Uint16Array(D):D,G=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],H=w?new Uint8Array(G):G,I=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],J=w?new Uint16Array(I):I,K=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,
12,12,13,13],L=w?new Uint8Array(K):K,M=new (w?Uint8Array:Array)(288),N,O;N=0;for(O=M.length;N<O;++N)M[N]=143>=N?8:255>=N?9:279>=N?7:8;var P=x(M),Q=new (w?Uint8Array:Array)(30),R,S;R=0;for(S=Q.length;R<S;++R)Q[R]=5;var T=x(Q);function U(b,c){for(var e=b.g,d=b.d,f=b.f,g=b.c,l;d<c;)l=f[g++],l===t&&r(Error("input buffer is broken")),e|=l<<d,d+=8;l=e&(1<<c)-1;b.g=e>>>c;b.d=d-c;b.c=g;return l}
function V(b,c){for(var e=b.g,d=b.d,f=b.f,g=b.c,l=c[0],k=c[1],h;d<k;){h=f[g++];if(h===t)break;e|=h<<d;d+=8}f=l[e&(1<<k)-1];l=f>>>16;b.g=e>>l;b.d=d-l;b.c=g;return f&65535}
function W(b){function c(b,c,d){var e,f,g;for(g=0;g<b;)switch(e=V(this,c),e){case 16:for(e=3+U(this,2);e--;)d[g++]=f;break;case 17:for(e=3+U(this,3);e--;)d[g++]=0;f=0;break;case 18:for(e=11+U(this,7);e--;)d[g++]=0;f=0;break;default:f=d[g++]=e}return d}var e=U(b,5)+257,d=U(b,5)+1,f=U(b,4)+4,g=new (w?Uint8Array:Array)(C.length),l;for(l=0;l<f;++l)g[C[l]]=U(b,3);f=x(g);g=new (w?Uint8Array:Array)(e);l=new (w?Uint8Array:Array)(d);b.l(x(c.call(b,e,f,g)),x(c.call(b,d,f,l)))}
y.prototype.l=function(b,c){var e=this.b,d=this.a;this.q=b;for(var f=e.length-258,g,l,k;256!==(g=V(this,b));)if(256>g)d>=f&&(this.a=d,e=this.e(),d=this.a),e[d++]=g;else{g-=257;k=E[g];0<H[g]&&(k+=U(this,H[g]));g=V(this,c);l=J[g];0<L[g]&&(l+=U(this,L[g]));d>=f&&(this.a=d,e=this.e(),d=this.a);for(;k--;)e[d]=e[d++-l]}for(;8<=this.d;)this.d-=8,this.c--;this.a=d};
y.prototype.u=function(b,c){var e=this.b,d=this.a;this.q=b;for(var f=e.length,g,l,k;256!==(g=V(this,b));)if(256>g)d>=f&&(e=this.e(),f=e.length),e[d++]=g;else{g-=257;k=E[g];0<H[g]&&(k+=U(this,H[g]));g=V(this,c);l=J[g];0<L[g]&&(l+=U(this,L[g]));d+k>f&&(e=this.e(),f=e.length);for(;k--;)e[d]=e[d++-l]}for(;8<=this.d;)this.d-=8,this.c--;this.a=d};
y.prototype.e=function(){var b=new (w?Uint8Array:Array)(this.a-32768),c=this.a-32768,e,d,f=this.b;if(w)b.set(f.subarray(32768,b.length));else{e=0;for(d=b.length;e<d;++e)b[e]=f[e+32768]}this.i.push(b);this.m+=b.length;if(w)f.set(f.subarray(c,c+32768));else for(e=0;32768>e;++e)f[e]=f[c+e];this.a=32768;return f};
y.prototype.v=function(b){var c=this.f.length/this.c+1|0,e=this.f,d=this.b;b&&("number"===typeof b.n&&(c=b.n),"number"===typeof b.s&&(c+=b.s));2>c?(b=(e.length-this.c)/this.q[2],b=258*(b/2)|0,b=b<d.length?d.length+b:d.length<<1):b=d.length*c;w?(b=new Uint8Array(b),b.set(d)):b=d;return this.b=b};
y.prototype.p=function(){var b=0,c=this.b,e=this.i,d,f=new (w?Uint8Array:Array)(this.m+(this.a-32768)),g,l,k,h;if(0===e.length)return w?this.b.subarray(32768,this.a):this.b.slice(32768,this.a);g=0;for(l=e.length;g<l;++g){d=e[g];k=0;for(h=d.length;k<h;++k)f[b++]=d[k]}g=32768;for(l=this.a;g<l;++g)f[b++]=c[g];this.i=[];return this.h=f};
y.prototype.t=function(){var b,c=this.a;w?this.r?(b=new Uint8Array(c),b.set(this.b.subarray(0,c))):b=this.b.subarray(0,c):(this.b.length>c&&(this.b.length=c),b=this.b);return this.h=b};function X(b){b=b.split("");var c,e;c=0;for(e=b.length;c<e;c++)b[c]=(b[c].charCodeAt(0)&255)>>>0;return b};function aa(b){var c,e,d;this.c=b;this.a=0;if(c||!(c={}))c.index&&(this.a=c.index),c.verify&&(this.d=c.verify);e=b[this.a++];d=b[this.a++];switch(e&15){case 8:break;default:r(Error("unsupported compression method"))}0!==((e<<8)+d)%31&&r(Error("invalid fcheck flag:"+((e<<8)+d)%31));d&32&&r(Error("fdict flag is not supported"));this.b=new y(b,{index:this.a,bufferSize:c.bufferSize,bufferType:c.bufferType,resize:c.resize})};var ba=window.a===t,Y=document.createElement("canvas"),Z=Y.getContext("2d");function $(b,c){var e=b.length-c,d,f,g,e=3*(e/4|0)+e%4;d=Array(e);for(g=f=0;g<e;++g)3===f%4&&f++,d[g]=String.fromCharCode(b[f++]);return d.join("")};v("PngPack.pack",function(b){var c,e,d,f;c=(b.length+2)/3|0;e=(c/32768|0)+1;Y.width=(c+e-1)/e|0;Y.height=e;c=Z.getImageData(0,0,Y.width,Y.height);e=c.data;d=0;for(f=b.length/3;d<f;++d)e[4*d]=b.charCodeAt(3*d)|0,e[4*d+1]=b.charCodeAt(3*d+1)|0,e[4*d+2]=b.charCodeAt(3*d+2)|0,e[4*d+3]=255;b=e.length-(4*(b.length/3|0)+b.length%3);Z.putImageData(c,0,0);c=Y.toDataURL("image/png");c=window.atob(c.slice(c.indexOf(",")+1));var g,l;g=8;for(l=c.length;g<l;)if(e=g,d=(c.charCodeAt(g++)<<24|c.charCodeAt(g++)<<16|
c.charCodeAt(g++)<<8|c.charCodeAt(g++))>>>0,f=c.slice(g,g+=4),g+=d,g+=4,"IEND"===f){c=[c.slice(0,e),String.fromCharCode(0,0,0,4),"plEN",String.fromCharCode(b>>24&255,b>>16&255,b>>8&255,b&255),String.fromCharCode(0,0,0,0),c.slice(e)].join("");break}return c});
v("PngPack.unpack",function(b){var c,e,d,f,g,l,k=[],h,m;b="data:image/png;base64,"===b.slice(0,22)?b.slice(22):b;c=X(b);b.slice(0,8)!==String.fromCharCode(137,80,78,71,13,10,26,10)&&r(Error("invalid png signature"));h=8;for(m=c.length;h<m;){d=(c[h++]<<24|c[h++]<<16|c[h++]<<8|c[h++])>>>0;f=h+d+8;switch(b.slice(h,h+=4)){case "IHDR":g=(c[h+0]<<24|c[h+1]<<16|c[h+2]<<8|c[h+3])>>>0;l=(c[h+4]<<24|c[h+5]<<16|c[h+6]<<8|c[h+7])>>>0;break;case "IDAT":k.push(c.slice(h,h+d));break;case "plEN":e=(c[h]<<24|c[h+
1]<<16|c[h+2]<<8|c[h+3])>>>0}h=f}b=new aa(Array.prototype.concat.apply([],k));c=b.c;for(k=b.b;!k.o;)switch(d=k,f=U(d,3),f&1&&(d.o=!0),f>>>=1,f){case 0:f=d.f;h=d.c;m=d.b;var q=d.a,n=t,p=t,s=t,F=m.length,n=t;d.g=0;d.d=0;n=f[h++];n===t&&r(Error("invalid uncompressed block header: LEN (first byte)"));p=n;n=f[h++];n===t&&r(Error("invalid uncompressed block header: LEN (second byte)"));p|=n<<8;n=f[h++];n===t&&r(Error("invalid uncompressed block header: NLEN (first byte)"));s=n;n=f[h++];n===t&&r(Error("invalid uncompressed block header: NLEN (second byte)"));
s|=n<<8;p===~s&&r(Error("invalid uncompressed block header: length verify"));h+p>f.length&&r(Error("input buffer is broken"));switch(d.k){case A:for(;q+p>m.length;){n=F-q;p-=n;if(w)m.set(f.subarray(h,h+n),q),q+=n,h+=n;else for(;n--;)m[q++]=f[h++];d.a=q;m=d.e();q=d.a}break;case z:for(;q+p>m.length;)m=d.e({n:2});break;default:r(Error("invalid inflate mode"))}if(w)m.set(f.subarray(h,h+p),q),q+=p,h+=p;else for(;p--;)m[q++]=f[h++];d.c=h;d.a=q;d.b=m;break;case 1:d.l(P,T);break;case 2:W(d);break;default:r(Error("unknown BTYPE: "+
f))}k=k.p();b.a=b.b.c;if(b.d){b=(c[b.a++]<<24|c[b.a++]<<16|c[b.a++]<<8|c[b.a++])>>>0;c=k;"string"===typeof c&&(c=X(c));d=1;f=0;h=c.length;for(q=0;0<h;){m=1024<h?1024:h;h-=m;do d+=c[q++],f+=d;while(--m);d%=65521;f%=65521}b!==(f<<16|d)>>>0&&r(Error("invalid adler-32 checksum"))}b=new (ba?Uint8Array:Array)(4*g*l);g*=4;for(d=0;d<l;++d){h=d*(1+g);m=d*g;f=k[h];for(c=0;c<g;++c)switch(s=k[h+c+1],f){case 0:b[h+c]=s;break;case 1:q=4>c?0:b[m+c-4];b[m+c]=q+s&255;break;case 2:p=0===d?0:b[m+c-g];b[m+c]=p+s&255;
break;case 3:q=4>c?0:b[m+c-4];p=0===d?0:b[m+c-g];b[m+c]=((q+p)/2|0)+s&255;break;case 4:F=4>c||0===d?0:b[m+c-4-g];q=4>c?0:b[m+c-4];p=0===d?0:b[m+c-g];n=Math.min([Math.abs(q-s),Math.abs(p-s),Math.abs(F-s)]);b[m+c]=n===Math.abs(q-s)?q+s&255:n===Math.abs(p-s)?p+s&255:F+s&255;break;default:r(Error("invalid filter"))}}return $(b,e)});
v("PngPack.unpackAsync",function(b,c){var e=document.createElement("canvas"),d=e.getContext("2d"),f=document.createElement("img");"data:"!==b.slice(0,5)&&(b="data:image/png;base64,"+window.btoa(b));f.addEventListener("load",function l(){var k,h,m,q=0,n,p;f.removeEventListener("load",l,!1);m=window.atob(b.slice(b.indexOf(",")+1));k=8;for(h=m.length;k<h;)p=(m.charCodeAt(k++)<<24|m.charCodeAt(k++)<<16|m.charCodeAt(k++)<<8|m.charCodeAt(k++))>>>0,n=m.slice(k,k+=4),"plEN"===n&&(q=(m.charCodeAt(k)<<24|m.charCodeAt(k+
1)<<16|m.charCodeAt(k+2)<<8|m.charCodeAt(k+3))>>>0),k+=p,k+=4;e.width=f.width;e.height=f.height;d.drawImage(f,0,0,f.width,f.height);k=d.getImageData(0,0,e.width,e.height).data;c($(k,q));f.src=""},!1);f.src=b});v("PngPack.toDoubleByteString",function(b){var c=[],e,d,f=0,g,l;c[f++]=String.fromCharCode(b.length%2);g=0;for(l=b.length;g<l;g+=2)e=b.charCodeAt(g),d=b.charCodeAt(g+1)|0,c[f++]=String.fromCharCode(e<<8|d);return c.join("")});
v("PngPack.fromDoubleByteString",function(b){var c=[],e,d,f,g,l,k=b.charCodeAt(0);f=0;g=1;for(l=b.length-1;g<l;++g)e=b.charCodeAt(g),d=e&255,e=e>>8&255,c[f++]=String.fromCharCode(e),c[f++]=String.fromCharCode(d);e=b.charCodeAt(++g);d=e&255;c[f++]=String.fromCharCode(e>>8&255);0===k&&(c[f]=String.fromCharCode(d));return c.join("")});}).call(this);
